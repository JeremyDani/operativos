# MODULOS PRINCIPALES DEL SISTEMA "OPERATIVOS"

Este archivo explica, en palabras sencillas, qué hace cada módulo principal del sistema y "dónde cae" cada cosa.

============================================================
1) CONFIGURACION (PROYECTO DJANGO PRINCIPAL)
============================================================

Ubicación: configuracion/

- Es el "corazón" del backend Django.
- Contiene la configuración global del proyecto:
  - settings.py  -> ajustes generales (BD, apps instaladas, estáticos, etc.)
  - urls.py      -> rutas principales del backend
  - asgi.py / wsgi.py -> puntos de entrada para servidores (desarrollo / producción)
- Piensa en esto como el panel eléctrico de la casa: aquí se enciende y conecta todo.

============================================================
2) APLICACIONES DJANGO (apps/)
============================================================

Dentro de la carpeta apps/ hay varios módulos (aplicaciones) separados por responsabilidad.

2.1) apps/cuenta
-----------------
- Maneja usuarios, perfiles y autenticación.
- Se apoya en el sistema de usuarios de Django y en grupos/permisos.
- Aquí viven cosas como:
  - Modelos de usuario/perfil (si hay personalización).
  - Formularios para login / registro (lado Django).
  - Vistas y URLs relacionadas con cuentas.
- Relación con el frontend:
  - El login del sistema (Vue) usa un endpoint JSON (`/api/cuenta/login/`) que valida el usuario y devuelve datos básicos (nombre, correo, roles, etc.).
  - Existe un endpoint de cambio de contraseña (`/api/auth/change-password`) que recibe la contraseña actual y la nueva, y actualiza la del usuario autenticado.
   - En el admin de Django, la aplicación técnica de **Django REST PasswordReset** está oculta del menú; se usa internamente para gestión de tokens de reseteo, pero no la ven los usuarios de negocio.

2.2) apps/operativos
---------------------
- Es el módulo principal para gestionar los "operativos" (campañas, jornadas, etc.).
- Tareas típicas de este módulo:
  - Crear, editar y listar operativos.
  - Asociar nóminas/listas de personas a un operativo.
  - Exponer endpoints para verificar una cédula dentro de un operativo.
  - Registrar participaciones nuevas (cuando alguien asiste/participa).
- El frontend usa estos endpoints para:
  - Mostrar la tabla de operativos.
  - Abrir la pantalla de verificación `/operativos/:id/verificar`.

2.3) apps/historico
--------------------
- Guarda el historial de participaciones.
- Cada vez que alguien participa en un operativo, se registra aquí un rastro histórico.
- Permite:
  - Saber si una persona ya participó antes (y en qué operativo).
  - Generar estadísticas y reportes a partir de estos datos.
- El módulo de reportes históricos del frontend se alimenta de este histórico.

2.4) apps/auxiliares
---------------------
- Agrupa funcionalidades de apoyo ("utilidades" del sistema).
- Puede contener:
  - Modelos de catálogos/maestros (entes, tipos de operativo, etc.).
  - Funciones auxiliares reutilizables por otras apps.
  - Vistas o APIs de referencia que no pertenecen a un solo módulo grande.

2.5) apps/frontend
-------------------
- Es una app Django ligera para integrar el frontend SPA con Django.
- Suele exponer vistas que devuelven la plantilla base donde se monta Vue.
- Se usa principalmente para servir la entrada del frontend cuando se despliega todo bajo Django.

============================================================
3) FRONTEND SPA (VUE + VITE)
============================================================

Ubicación: frontend/

- Contiene la aplicación de una sola página (SPA) hecha con Vue 3 y Vite.
- Estructura principal:
  - src/main.js     -> punto de entrada de Vue.
  - src/router.js   -> definición de rutas (login, operativos, verificación, reportes, etc.).
  - src/App.vue     -> layout principal (header, contenedor de vistas).
  - src/components/ -> componentes de interfaz (Login, listas, verificación, reportes, etc.).
- Rutas típicas del frontend:
  - /login                     -> pantalla de inicio de sesión.
  - /operativos                -> listado de operativos.
  - /operativos/:id/verificar  -> verificación de cédula en un operativo concreto.
  - /reportes/historico        -> reportes / estadísticas históricas.
  - /perfil                    -> datos básicos del usuario (nombre, cédula, correo, roles).
  - /ajustes                   -> pantalla de ajustes personales (incluye cambio de contraseña).
- El frontend consume la API del backend (las apps Django) para mostrar datos y registrar acciones.

3.1) Componentes y pantallas destacadas
---------------------------------------

- Pantalla de operativos (`/operativos` — componente Operativos.vue):
  - Muestra la lista de operativos disponibles.
  - Incluye un icono de calendario en la parte superior del sistema.
  - Al hacer clic en ese icono se abre un calendario emergente (modal) que muestra:
    - Puntos rojos en los días con operativos que ya comenzaron.
    - Puntos verdes en los días con operativos que están por iniciar.
  - El calendario permite navegar por meses y años.
  - Si se hace clic en un día, la lista de operativos se filtra para mostrar solo los de esa fecha; se puede quitar el filtro desde un aviso sobre la lista.

- Pantalla de reportes históricos (`/reportes/historico` — componente ReportesHistorico.vue):
  - Título principal: "Reporte".
  - Subtítulo: "Reporte  de participaciones en los operativos".
  - Muestra un rango de fechas (desde / hasta) en la parte superior, que filtra las estadísticas históricas.
  - Presenta gráficas y listados agregados por ente y por tipo de operativo.
  - Tiene un botón "Descargar PDF" que usa la función de impresión del navegador para generar un PDF/captura del reporte con el rango de fechas seleccionado.

- Pantalla de verificación de trabajador (`/operativos/:id/verificar` — componente VerificarTrabajador.vue):
  - Permite ingresar una cédula (con selector de origen V/E) y verificar si la persona existe en las nóminas asociadas al operativo y en el histórico de participaciones.
  - Si el trabajador ya participó recientemente en ese operativo, se muestra un mensaje informativo y no se permite volver a registrarlo.
  - Si se encuentra un trabajador válido y sin participación reciente, se abre un modal titulado **"Datos del Trabajador"** con los datos básicos (Ente, Origen y Cédula, Nombre y Apellido) y botones para confirmar o cancelar el registro de participación.
  - Se eliminó el recuadro fijo "Resultado para la Cédula"; la confirmación se hace directamente desde el modal.

- Pantalla de perfil (`/perfil` — componente Profile.vue):
  - Lee la información del usuario autenticado (nombre, cédula, correo, roles) desde el store de autenticación.
  - Muestra esta información de forma resumida para que el usuario sepa con qué cuenta está trabajando.

- Pantalla de ajustes (`/ajustes` — componente Settings.vue):
  - Accesible desde el icono de usuario en la barra superior.
  - Contiene una opción "Cambio de contraseña" que, al hacer clic, abre una ventana emergente.
  - En el modal se solicita la contraseña actual, la nueva y su confirmación; al enviar el formulario se llama al endpoint backend `/api/auth/change-password`.
  - Se muestran mensajes claros de éxito o error según la respuesta del servidor.

- Comportamiento de sesión en el frontend:
  - El estado de usuario se guarda en una sesión de navegador (sessionStorage), de forma que al cerrar la pestaña o ventana, la información se pierde y será necesario iniciar sesión de nuevo al reabrir la aplicación.
  - La barra superior muestra iconos distintos según el rol:
    - Icono de calendario: visible para cualquier usuario autenticado (operadores, analistas, administradores).
    - Icono de reportes: visible para administradores, analistas y usuarios sin rol, pero no para operadores.

3.2) Panel de administración y roles
------------------------------------

- El acceso al panel de administración de Django (`/admin`) se controla con `is_staff` y grupos:
  - Usuarios del grupo **administrador** se tratan como administradores funcionales de la aplicación: en el admin solo ven principalmente las secciones de **Autenticación y autorización** y **Cuenta**; los módulos de **Operativos** y **Auxiliares** se ocultan para reducir riesgos.
  - Usuarios del grupo **analista** se configuran como usuarios de staff (`is_staff = True`) cuando necesitan acceso al admin para consultas avanzadas, manteniendo la configuración técnica bajo control.

============================================================
4) SCRIPTS Y TAREAS DE MANTENIMIENTO (scripts/)
============================================================

Ubicación: scripts/

- Son pequeños programas Python que ayudan en tareas de operación y mantenimiento.
- Ejemplos:
  - backup_participaciones.py
  - backup_and_clear_participaciones_historico.py
  - clear_participaciones.py
- Suelen usarse para:
  - Hacer respaldos de tablas importantes.
  - Limpiar historiales muy grandes.
  - Poblar o ajustar datos de prueba.
- Normalmente se ejecutan desde consola, dentro del entorno virtual, con:

  python manage.py shell < scripts/nombre_script.py

(o bien importando los módulos desde un shell interactivo).

============================================================
5) ARCHIVOS ESTÁTICOS Y PLANTILLAS
============================================================

5.1) static/ y staticfiles/
---------------------------
- static/      -> estáticos propios del proyecto (CSS, JS, imágenes).
- staticfiles/ -> carpeta generada por collectstatic (para producción).
- Incluyen, por ejemplo:
  - Estilos de login (login.css).
  - Librerías de terceros (adminlte, bootstrap, etc.).

5.2) templates/
----------------
- Plantillas HTML de Django.
- Aquí viven las vistas del admin personalizado y otras pantallas basadas en servidor.
- Aunque el frontend principal es SPA con Vue, estas plantillas siguen siendo útiles para:
  - El panel de administración.
  - Páginas específicas que se sirven directamente desde Django.

============================================================
6) RESUMEN MENTAL RAPIDO
============================================================

- "configuracion/"      -> Configuración global del proyecto Django.
- "apps/cuenta"         -> Usuarios, login, permisos.
- "apps/operativos"     -> Gestión de operativos y verificación en campo.
- "apps/historico"      -> Historial de participaciones y base de reportes.
- "apps/auxiliares"     -> Catálogos y utilidades compartidas.
- "apps/frontend"       -> Puente entre Django y la SPA.
- "frontend/"           -> Aplicación Vue (pantallas que ve el usuario final).
- "scripts/"            -> Tareas especiales: backups, limpieza, pruebas.
- "static/", "templates/" -> Recursos visuales y plantillas de Django.

Con esto deberías tener un mapa claro de "qué hace cada módulo" y dónde buscar cuando necesites cambiar algo o investigar un comportamiento.
